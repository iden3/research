% Bibliografia: patches, unsecure MiMC-7.

\documentclass{article}
\usepackage[colorlinks=true,
			urlcolor=black,
			linkcolor=black,
			citecolor=black
			]{hyperref} 

\input{preamble.tex}

\makeatletter
\renewcommand\AB@affilsepx{, \protect\Affilfont}
\makeatother

\title{ EdDSA For Baby Jubjub Elliptic Curve with MiMC-7 Hash \vspace{-0.2cm} }
\author[1]{Jordi Baylina}
\author[1,2]{Marta BellÃ©s}
\affil[1]{iden3}
\affil[2]{Universitat Pompeu Fabra}
\date{} %% if you don't need date to appear
\setcounter{Maxaffil}{0}
\renewcommand\Affilfont{\itshape\small}
% \includegraphics[scale=0.3]{iden3.png} 

\begin{document}
\begin{spacing}{1.2}
\maketitle 
\vspace{1cm}
\tableofcontents

\vspace{0.5cm}

\newpage

\section{Scope}
This proposal aims to standarize the elliptic curve signature scheme Edwards-curve Digital Signature Algorithm (EdDSA) for Baby Jubjub Edwards elliptic curve using MiMC-7 hash function.

\section{Motivation}
EdDSA is a variant of Schnorr's signature scheme and it provides high performance on a variety of platforms \cite{eddsa}. 

\section{Background}
There are many implementations of EdDSA with Edwards elliptic curves such as Ed25519 or Ed448-Goldilocks and most of them use hash SHA-512. This is the first document specifying a protocol for implementing EdDSA using MiMC-7 and we describe it on the Baby Jubjub Elliptic curve.  \\

The choice of the MiMC-7 hash function makes computations inside circuits very efficient and it has a big potential in zero knowledge protocols such as zk-SNARK.
%	
%\section{Motivation}				\input{motivation}
%	
%\section{Background}				\input{background}
	
\section{Terminology}	%			\input{terminology}	
The table below summarizes the terminology used across the document. Each element is explained in greater detail in the following sections.
	
		\begin {table}[h!]
	\centering
	\begin{tabular}{|l|l|}
		\hline
		{\bf Notation} & {\bf Description}\\
		\hline
		{$p$} & {Prime number.}\\
		{$\Fp$} & {Finite field with $p$ elements.}\\
		{$E$} & {Baby Jubjub elliptic curve (defined over $Fp$) in Edwards form.}\\
		{$E_M$} & {Baby Jubjub elliptic curve (defined over $Fp$) in Montgomery form.}\\
		{$l$} & {Large prime number dividing the order of Baby Jubjub.}\\
		{$\Fl$} & {Finite field with $l$ elements.}\\
		{$\G$} & {Group of $\Fp$-rational points of order $l$.}\\
		{$B$} & {Base point (generator of $\G$) of Baby Jubjub.}\\
		\hline
		{$A = (A_x, A_y)$} & {Public key. $A$ is a point on $E$. }\\
		$k$ & Private key. \\
		$M$ & Message. $M$ is an element of $\Fl$. \\		
		{$(R,S) = ((R_x, R_y), S)$} & Signature on $M$. $R$ is a point on $E$ and $S$ and element of $\Fl$.\\
		\hline		
		{$H$} & {Hash function MiMC-7.}\\
		$r$ & Number of rounds of MiMC-7. \\
		$c_0, c_1, \dots, c_r$ & Constants used in MiMC-7. \\
		\hline
	\end{tabular}
%	\caption{Notation for the EdDSA signature scheme.}
	\label{tab:notation}
	\end{table}
	
	\subsection{Baby-Jubjub} 	\input{baby-jubjub}
	\subsection{MiMC-7}			\input{mimc7}
	\subsection{EdDSA}
	
	The description of this protocol is based in \cite{eddsa}:  
%	
%	Let $k$ be a private key chosen uniformly at random. 
%	
	Let the public key be a point $A = (A_x, A_y)\in E$ of order $l$ and $M$ a message we wish to sign. The signature on $M$ by $A$ consists of a par $(R,S)$ where $R = (R_x, R_y)$ is a point of order $l$ of $E$ and $S\in\Fl\backslash\{0\}$ such that 
			$$ 8SB = 8R + 8H(R,A,M)A.	$$
%	The private key $k$ consists		
		
%		\subsection{Circuit}
	
\section{Challenges and security}
One of the main challenges to create this standard and to see it adopted by the community
is to provide correct, usable, and well-maintained implementations in as many languages as
possible. 
%
Some effort is also required to audit and verify code coming from the community and claiming
to implement EdDSA for Baby Jubjub to prevent the propagation of potentially
insecure implementations. Part of the work in progress of looking batch verification of short signatures. 
%
Lastly, the proposal as it stands uses MiMC-7 as hash function as it works very optimal inside circuits. We believe some work is required to determinate the security MiMC hash functions. 
%
%				\input{challenges} 

% This section is not in the supposed structure of the doc.	
% \section{Description}				\input{description}

% \section{Security}					\input{security}
	
\section{Implementation}			% \input{implementation}
In this section, we specify how each of the main operations in the following EdDSA circuit are computed:
% To compute the following	EdDSA circuit 
\begin{figure}[h]
	\centering
	\includegraphics[scale=0.4]{circuit-eddsa.png}
\end{figure}
% we specify in each how each of the operations are computed. 
%	
%	\subsection{Circuit}
%	\begin{figure}[h]
%	\centering
%		\includegraphics[scale=0.6]{circuit-eddsa.png}
%	\end{figure}

	\subsection{Operations in the elliptic curve}
		\subsubsection{Addition of points} \input{addition}
		\subsubsection{Multiplication of a point of $E$ by a scalar} \input{multiplication}
			\subsection{MiMC-7}
		\label{sec-mimc}
				
				
		The specifications we use in the hash are ({\it we are working in explaining this section in greater detail}):

		\begin{enumerate}
		\item Number of rounds: $ r = \ceil*{\frac{\llog l}{\llog 7}} = 91. $
		
		\item Inputs: \begin{itemize}
					\item Coordinates of the public key: ($A_x, A_y$).
					\item Coordinates of the point $8R$: ($R8_x, R8_y$).
					\item Message $M$. 
				\end{itemize}
		\item Number of inputs: 5.

		\item Generation of constants:  \url{https://github.com/iden3/circomlib/blob/master/src/mimc7.js}.
		\end{enumerate}
			%		exports.getConstants = (seed, nRounds) => {
			%			if (typeof seed === "undefined") seed = SEED;
			%			if (typeof nRounds === "undefined") nRounds = NROUNDS;
			%			const cts = new Array(nRounds);
			%			let c = Web3Utils.keccak256(SEED);
			%			for (let i=1; i<nRounds; i++) {
			%				c = Web3Utils.keccak256(c);
			%				
			%				const n1 = Web3Utils.toBN(c).mod(Web3Utils.toBN(F.q.toString()));
			%				const c2 = Web3Utils.padLeft(Web3Utils.toHex(n1), 64);
			%				cts[i] = bigInt(Web3Utils.toBN(c2).toString());
			%			}
			%			cts[0] = bigInt(0);
			%			return cts;
			%		};
			% https://github.com/iden3/circomlib/blob/master/src/mimc7.js
			% Work in progress
		
	\subsection{Example and test vectors}
	{\it Work in progress.}
	\subsection{Existing implementations}
	EdDSA for Baby Jubjub implemented by Jordi Baylina in circom (zero knowledge circuit compiler):\\ \url{https://github.com/iden3/circomlib/blob/master/circuits/eddsamimc.circom}
\section {Intellectual Property}	\input{intellectual-property}
We will release the final version of this proposal under creative commons, to ensure it is freely available
to everyone.

\addcontentsline{toc}{section}{References}
\bibliographystyle{acm}
\bibliography{lit}
\end{spacing}
\end{document}