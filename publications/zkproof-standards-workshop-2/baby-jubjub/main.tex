%% Baby jubjub - Standarisation proposal

\documentclass{article}
\usepackage[colorlinks=true,
			urlcolor=black,
			linkcolor=black,
			citecolor=black
			]{hyperref} 

\input{preamble.tex}

\makeatletter
\renewcommand\AB@affilsepx{, \protect\Affilfont}
\makeatother

\title{ Baby Jubjub Elliptic Curve \vspace{-0.2cm} }
\author[1]{Barry WhiteHat}
\author[2]{Jordi Baylina}
\author[2,3]{Marta Bellés}
\author[2]{Jacques Dafflon}
\affil[1]{Ethereum foundation}
\affil[2]{iden3}
\affil[3]{Universitat Pompeu Fabra}
\date{} %% if you don't need date to appear
\setcounter{Maxaffil}{0}
\renewcommand\Affilfont{\itshape\small}
% \includegraphics[scale=0.3]{iden3.png} 

\begin{document}
\begin{spacing}{1.2}	
% \vspace{1cm}
\maketitle 
\vspace{1.5cm}
\tableofcontents
\vspace{0.5cm}


\newpage

\section{Scope}
	\input{scope}

\section{Motivation}
	\input{motivation}

\section{Background}
	\input{background}

\section{Terminology and description}
	\subsection{Generation of Baby Jubjub}

	In 2016, a group of researchers of IRPF designed a deterministic algorithm that, given a prime number $p$, it returns the elliptic curve defined over $\Fp$ with smallest coefficient $A$ such that $A-2$ is a multiple of 4 and equation $y^2 = x^3 + Ax^2 + x$ describes a Montgomery curve. The assumption $A-2$ divisible by 4 comes from the fact that as 
	this value is used in many operations, so trying to keep it smaller and divisible by four is a reasonable assumption \cite{generation-baby}. \\

	SafeCurves is a project that checks some of the most common and known attacks on several elliptic curves. It also provides the algorithm it was used \cite{safe-curves}.\\ 
	
	We considered the large prime number dividing the order of BN128 and run algorithm A.1 from \cite{generation-baby}. The first elliptic curve it was returned  satisfying SafeCurves criteria was the Montgomery curve with coefficient $A = 168698$. This curve was named Baby Jubjub elliptic curve.  
%	
%	SafeCurves: choosing safe curves for elliptic-curve cryptography. 
%	
%	Baby-Jubjub is is the result of this algorithm combined with the OBLIGATION  the satisfiability of SafeCurves criteria. %together with combining 
%	% of two things: the application of this algorithm and the satisfiability of SafeCurves criteria. 
%	This second requirement is checked using SUCH AND SUCH ALGORITHM (FIRST SAFECURVES - DAIRA - BARRY). \\
%	
%	To start, consider the large prime  
%	$$ p = ... ,$$
%	which %is the large prime dividing 
%	that divides the order of BN128 elliptic curve [REF]. 
%	Then  $A = 168698$ is the smallest coefficient provided by algorithm SUCH (as $p\equiv1\mod4$) that satisfies SafeCurves criteria. \\
%	%As $p \equiv 1 \mod 4$, we used Appendix A, algorithm A.1. 
%%	This ref: We used the algorithm from appendix A.%
%%	%https://tools.ietf.org/html/rfc7748
%%	We take p as the curve order of bn128curve (REF) to embed them.
%%	
%%	Equivalent to (twisted) Edwards.
%%	
%%	As
%%	$p=...$
%%	és = 1 mòdul 4.
%%	
%%	Baby-Jubjub 
%%	Baby-Jubjub is the result of using this algorithm with the prime
%%	$ p = ... ,$
%%	which is the large prime dividing the order of BN128 elliptic curve [REF].
%%
%%	Specifically, it defines how to generate the parameter
%%	A of the Montgomery curve $y^2 = x^3 + A*x^2 + x$.  
%%	
%%		BN128 elliptic curve [REF] is defined by such and has a large subgroup of prime order
%%	$p = $. 
%	%Let $p$ be a prime number and $\Fp$ the finite field with $p$ elements. Let $E$ be an elliptic curve defined over $\Fp$ of order $n = h\times r$, where $r$ is a large prime and $h$ is typically a small positive integer called cofactor.\\ 
%	%% The notation used in this document is the following one.
%	%
%	%\begin{table}[htp]
%	%	\begin{center}
%	%		\begin{tabular}{c|c|c}
%	%			{\bf Group} & {\bf Description} & {\bf Order} \\
%	%			\hline 
%	%			$\Fp$ & Finite field with $p$ elements & $p$\\
%	%			$E$ & Elliptic curve group & $n = h\times r$\\
%	%			$\G \subseteq E$ & Subgroup of points of $E$ of order $r$ & $r$%\\
%	%		\end{tabular}
%	%	\end{center}
%	%\end{table}
%	
%
%	%Baby-Jubjub elliptic curve is the result of a deterministic algorithm [REF]. 
%	%Appendix A.  Deterministic Generation. 
%	
%%	Then, stack with the curve that satisfies SafeCurves critera, we used this algorithm, which a variation (based on) of the one proposed by Daria-Hoopewood and ZCash team [REF].
%
%%that satisfies SafeCurves criteria.
%%
%%This procedure is
%%intended to be as objective as can reasonably be achieved so that
%%it's clear that no untoward considerations influenced the choice of
%%curve.  
%%
%%The input to this process is p, the prime that defines the
%%underlying field. 
%%
%%The value (A-2)/4 is used in several of the elliptic curve point
%%arithmetic formulas.  For simplicity and performance reasons, it is
%%beneficial to make this constant small, i.e., to choose A so that
%%(A-2) is a small integer that is divisible by four.
%%	
%	
%	
%	
%	
%	%% Generating a curve where p = 1 mod 4
%	%\begin{lstlisting}
%	%def findCurve (prime, curveCofactor, twistCofactor):
%	%	F = GF(prime)
%	%	
%	%	for A in xrange(3, int(1e9)):
%	%		if (A-2) % 4 != 0:
%	%			continue
%	%	
%	%		try:
%	%			E = EllipticCurve(F, [0, A, 0, 1, 0])
%	%		except:
%	%			continue
%	%		
%	%		groupOrder = E.order()
%	%		twistOrder = 2*(prime+1)-groupOrder
%	%	
%	%	if (groupOrder % curveCofactor == 0 and
%	%		is_prime(groupOrder // curveCofactor) and
%	%		twistOrder % twistCofactor == 0 and
%	%		is_prime(twistOrder // twistCofactor)):
%	%		return A
%	%	
%	%def find1Mod4 (prime):
%	%	assert((prime % 4) == 1)
%	%	return findCurve(prime, 8, 4)
%	%\end{lstlisting}
%	
%%	This is the lowest A=168698 of a montgomary curve that statifies the critieria defined in ref7748
%%	This ref: We used the algorithm from appendix A.%
%%	%https://tools.ietf.org/html/rfc7748
%%	We take p as the curve order of bn128curve (REF) to embed them.
%%	
%%	Equivalent to (twisted) Edwards.
%%	
%%	As
%%	$p=...$
%%	és = 1 mòdul 4.


	\subsection{Definition of Baby Jubjub} \input{baby-jubjub}	
	From now on, let 
		$$	p = 21888242871839275222246405745257275088548364
				400416034343698204186575808495617 $$
	and $\Fp$ the finite field with $p$ elements. 
	
		\subsubsection{Montgomery form}
		%\input{baby-jubjub-montgomery}
		We define $E_M$ as the {\it Baby-Jubjub} Montgomery elliptic curve defined over $\Fp$ given %described
		by equation
		$$	E: v^2 = u^3 +  168698u^2 + u. $$
		The order of $E_M$ is $n = 8\times r$, where 
		$$	r = 2736030358979909402780800718157159386076813972
		158567259200215660948447373041 $$ 
		is a prime number. Denote by $\G$ the subgroup of points of order $r$, that is, %of $E$ 
		$$\G = \Set{ P \in E(\Fp) | r P = O  }.$$

		\subsubsection{Edwards form}
		$E_M$ is birationally equivalent to the Edwards elliptic curve %[REF] defined by  
			$$	E: x^2 + y^2 = 1 +  d x^2 y^2 $$
		where
		$ d = 9706598848417545097372247223557719406784115219466060233080913168975159366771.$ \\
		
		% \subsubsection{Birational equivalence}
	
		The birational equivalence [REF] from $E$ to $E_M$ is the map
		% These results are from \cite[Theorem 3.2]{twisted}. 
		$$ (x,y) \to (u,v) = \left( \frac{1 + y}{1 - y} , \frac{1 + y}{(1 - y)x} \right) $$
		with inverse from $E_M$ to $E$
		$$ (u, v) \to (x, y) = \left(  \frac{u}{v}, \frac{u - 1}{u + 1}   \right). $$
		
	%\input{baby-jubjub-edwards}
	\subsection{Arithmetic in the elliptic curve}
	In this section we define how to operate on the elliptic curve group: %two operations supported in the elliptic curve group: 
	the addition of points and multiplication of a point by a scalar (an element of $\Fp$).
	 	\subsubsection{Addition of points} \input{addition}
	 	\subsubsection{Multiplication of a point of $E$ by a scalar} \input{multiplication}

\section{Challenges and security}	\input{security}
	As required in the construction of Baby-Jubjub, the curve satisfies SafeCurves criteria. This can be checked following \cite{github-barry}.
	
\section{Implementation}		%	\input{implementation}		
	Barry WhiteHat:	
	\begin{itemize}
		\item %Description, generation and cryptographic requirements:
		\url{https://github.com/barryWhiteHat/baby_jubjub}
		\item \url{https://github.com/barryWhiteHat/baby_jubjub_ecc} 
	\end{itemize}
	Jordi Baylina: \url{https://github.com/iden3/circomlib/blob/master/src/babyjub.js}
	
\section {Intellectual Property}
	\input{intellectual-property}
%	Creative Commons.

%	\newpage
	\addcontentsline{toc}{section}{References}
	\bibliographystyle{acm}
	\bibliography{lit}
\end{spacing}	
\end{document}
